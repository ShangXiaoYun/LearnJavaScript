<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>使用Map实现Promise队列</title>
    <script src="js/ajax.js"></script>
</head>
<body>
    <script>
        // function queue(num){
        //     let promise = Promise.resolve();
        //     num.map(v=>{
        //         promise = promise.then(_=>{
        //             return new Promise(resolve=>{
        //                 setTimeout(()=>{
        //                     console.log(v);
        //                     resolve();
        //                 },1000)
        //             })
        //         })
        //     })
        // }

        // function queue(num){
        //     let promise = Promise.resolve();
        //     num.map(v=>{
        //         //没有重新赋promise,则then都是针对外层的哪个promise,
        //         //因为都是同一个状态,所以一起输出
        //         promise.then(_=>{
        //             return new Promise(resolve=>{
        //                 setTimeout(()=>{
        //                     console.log(v);
        //                     resolve();
        //                 },1000)
        //             })
        //         })
        //     })
        // }
        // queue([1,2,3,4,5]);

        function queue(num){
            let promise = Promise.resolve();
            num.map(v=>{
                promise = promise.then(_=>{
                    return v();
                })
            })
        }

        function p1(){
            return new Promise(resolve=>{
                setTimeout(()=>{
                    console.log("p1");
                    resolve();
                },1000)
            })
        }

        function p2(){
            return new Promise(resolve=>{
                setTimeout(()=>{
                    console.log("p2");
                    resolve();
                },1000)
            })
        }
        queue([p1,p2]);
    </script>
</body>
</html>