<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>promise.resolve缓存后台数据</title>
    <script src="js/ajax.js"></script>
</head>
<body>
    <script>
        //Promise.resolve相当于下面的代码，只是封装好了
        Promise.hd = function(value){
            return new Promise(resolve => {
                resolve(value);
            });
        };
        Promise.hd("Sophie").then(value => {
            console.log(value);
        });
        // function hd(){}
        // hd.site = "Sophie";
        // console.dir(hd);
        // console.log(Promise.resolve("Sophie"));  //'fulfilled'状态
        // Promise.resolve("Sophie").then(value=>{
        //     console.log(value); //Sophie
        // })
        function query(name){
            const cache = query.cache || (query.cache = new Map());
            if(cache.has(name)){
                console.log("走缓存了");
                return Promise.resolve(cache.get(name));
            }
            //ajax已经封装为Promsie
            return ajax(`http://localhost:8888/php/user.php?name=${name}`).then(
                user => {
                    cache.set(name,user);
                    console.log("没走缓存");
                    console.log(user);
                }
            )
        }

        query("后盾人").then(user => {
            console.log(user);
        });

        setTimeout(()=>{
            query("后盾人").then(user => {
                console.log(user);
            });
        },1000)
    </script>
</body>
</html>